#if defined(__GNUC__) || defined(_MSC_VER)
#define restrict __restrict
#else
#define restrict
#endif

extern "C" {
#include <onnc/Runtime/onnc-runtime.h>
}

#undef restrict

#include "relative-error.hpp"
#include <skypat/skypat.h>
SKYPAT_F(Operator_Gather, test_gather_0) {
  const float input_0[] = {
      -1.1623728,   -0.12717023, 0.7856541,   0.33969516,  0.05251464,
      0.11260425,   -2.1188467,  0.25967675,  0.8702081,   -0.1352238,
      0.11444635,   0.9360397,   -0.9242562,  -0.07575008, 1.0478106,
      -0.32683003,  -0.13428082, -1.9310074,  -0.43455684, 1.0091792,
      0.067704245,  -1.2129618,  0.56208116,  0.37493068,  0.14847748,
      1.1054957,    0.60564476,  -0.47187617, 1.0276043,   1.9330548,
      0.691014,     0.2814555,   -0.54253775, -2.096039,   0.62577313,
      -0.18923494,  0.7560868,   -1.3716149,  -0.8387352,  -1.2599313,
      0.20704015,   0.5071264,   -0.5528509,  -1.1686516,  1.2773861,
      -1.0028697,   -1.433036,   -0.3823114,  0.18595937,  0.23422886,
      0.38219175,   -0.1376838,  -0.9277951,  -3.0250773,  -0.8987511,
      -1.2069775,   -1.5914797,  0.57869893,  0.9283131,   -0.8217178,
      -0.6971097,   -0.96319073, -0.37040043, 0.22934242,  -1.1420017,
      -0.965297,    0.79340065,  0.6584246,   -0.45779777, 0.5671965,
      0.10614944,   -1.0894989,  -1.8696648,  0.58259094,  -0.5989167,
      -1.2720158,   0.96507263,  -1.2666684,  1.4387889,   -0.46558857,
      1.4075544,    0.8750866,   1.393339,    -0.5803563,  0.23095024,
      1.113878,     -0.46662915, -0.4050513,  -1.1934623,  -0.09674024,
      1.678695,     -1.0788695,  0.28488514,  -0.9358874,  -1.6657302,
      0.4446333,    -0.5717491,  0.6186073,   1.8606083,   0.14026126,
      2.1530573,    2.6407895,   1.1236545,   -1.661689,   1.0087669,
      1.187764,     1.9855745,   0.9543971,   0.40422595,  -1.0406047,
      -0.035430863, 0.5305499,   0.6779135,   -0.9001142,  -0.69391096,
      0.23800196,   2.817687,    -0.29260853, 0.7002011,   0.81807685};
  const int32_t input_0_ndim = 4;
  const int32_t input_0_dims[] = {5, 4, 3, 2};
  const float input_1[] = {0, 1, 3};
  const int32_t input_1_ndim = 1;
  const int32_t input_1_dims[] = {3};
  float output_0[72];
  const int32_t output_0_ndim = 4;
  const int32_t output_0_dims[] = {3, 4, 3, 2};
  const float answer_0[] = {
      -1.1623728,  -0.12717023, 0.7856541,   0.33969516,  0.05251464,
      0.11260425,  -2.1188467,  0.25967675,  0.8702081,   -0.1352238,
      0.11444635,  0.9360397,   -0.9242562,  -0.07575008, 1.0478106,
      -0.32683003, -0.13428082, -1.9310074,  -0.43455684, 1.0091792,
      0.067704245, -1.2129618,  0.56208116,  0.37493068,  0.14847748,
      1.1054957,   0.60564476,  -0.47187617, 1.0276043,   1.9330548,
      0.691014,    0.2814555,   -0.54253775, -2.096039,   0.62577313,
      -0.18923494, 0.7560868,   -1.3716149,  -0.8387352,  -1.2599313,
      0.20704015,  0.5071264,   -0.5528509,  -1.1686516,  1.2773861,
      -1.0028697,  -1.433036,   -0.3823114,  -1.8696648,  0.58259094,
      -0.5989167,  -1.2720158,  0.96507263,  -1.2666684,  1.4387889,
      -0.46558857, 1.4075544,   0.8750866,   1.393339,    -0.5803563,
      0.23095024,  1.113878,    -0.46662915, -0.4050513,  -1.1934623,
      -0.09674024, 1.678695,    -1.0788695,  0.28488514,  -0.9358874,
      -1.6657302,  0.4446333};
  const int32_t axis = 0;
  ONNC_RUNTIME_gather_float(nullptr, input_0, input_0_ndim, input_0_dims,
                            input_1, input_1_ndim, input_1_dims, output_0,
                            output_0_ndim, output_0_dims, axis);
  ASSERT_TRUE(relative_error(output_0, answer_0, 72) < 1e-5f);
}

SKYPAT_F(Operator_Gather, test_gather_1) {
  const float input_0[] = {
      0.13919811,  0.058822602,  -2.0245633,   -0.310773,   1.0181472,
      -1.7501725,  1.2847786,    1.0506443,    2.0316324,   1.5610716,
      -0.26930037, -0.4619064,   0.58822167,   -1.4978129,  -2.1679225,
      -1.5425048,  0.7879236,    0.746273,     0.57340187,  2.2909584,
      -0.6491914,  0.7773948,    -0.46254423,  0.71315795,  1.692353,
      -1.5411284,  -0.051713802, -0.22904511,  0.19878848,  -0.9162489,
      -0.20518364, 0.9416787,    -1.4896028,   0.7551656,   -0.32119885,
      1.4411341,   -0.6390382,   0.91698784,   -0.7565757,  0.22486532,
      0.030441405, 1.2714467,    1.3815565,    -0.46772662, 0.3888519,
      0.06724625,  -0.4874985,   1.3578132,    -0.1302975,  -0.6131891,
      -0.47019222, -0.7177667,   -0.65571785,  -1.4048791,  -1.222255,
      -0.22261828, -0.5996478,   0.772745,     0.89560866,  1.3172688,
      -1.1951784,  0.45006043,   2.0808127,    0.1613085,   -0.45397505,
      0.9358816,   -0.4758454,   0.46795473,   0.3160737,   -0.82523125,
      -0.8950024,  -0.84311604,  -1.4923718,   -1.2019495,  0.58521986,
      0.085883036, 0.31559283,   -0.09219062,  0.3104727,   -0.13475694,
      -0.6489179,  0.40765426,   -0.14116016,  0.86180204,  1.0696403,
      0.36044395,  0.9755205,    1.1449155,    -0.6057426,  -0.60139316,
      0.6627255,   0.1571705,    0.5356045,    0.103602305, 0.17960587,
      0.49856997,  1.9265591,    -0.113237806, 0.84214747,  0.54692334,
      -0.48253217, 1.533446,     -0.88926864,  2.8953416,   -2.022487,
      -2.1422625,  -0.45705467,  0.26532492,   -0.06950991, -0.07632891,
      0.41160914,  0.9888676,    0.3645659,    0.64047384,  0.12462137,
      -1.0073725,  1.0095638,    -0.28189024,  0.47143045,  2.502574};
  const int32_t input_0_ndim = 4;
  const int32_t input_0_dims[] = {5, 4, 3, 2};
  const float input_1[] = {0, 1, 3};
  const int32_t input_1_ndim = 1;
  const int32_t input_1_dims[] = {3};
  float output_0[90];
  const int32_t output_0_ndim = 4;
  const int32_t output_0_dims[] = {5, 3, 3, 2};
  const float answer_0[] = {
      0.13919811,   0.058822602, -2.0245633,  -0.310773,    1.0181472,
      -1.7501725,   1.2847786,   1.0506443,   2.0316324,    1.5610716,
      -0.26930037,  -0.4619064,  0.57340187,  2.2909584,    -0.6491914,
      0.7773948,    -0.46254423, 0.71315795,  1.692353,     -1.5411284,
      -0.051713802, -0.22904511, 0.19878848,  -0.9162489,   -0.20518364,
      0.9416787,    -1.4896028,  0.7551656,   -0.32119885,  1.4411341,
      1.3815565,    -0.46772662, 0.3888519,   0.06724625,   -0.4874985,
      1.3578132,    -0.1302975,  -0.6131891,  -0.47019222,  -0.7177667,
      -0.65571785,  -1.4048791,  -1.222255,   -0.22261828,  -0.5996478,
      0.772745,     0.89560866,  1.3172688,   -0.4758454,   0.46795473,
      0.3160737,    -0.82523125, -0.8950024,  -0.84311604,  -1.4923718,
      -1.2019495,   0.58521986,  0.085883036, 0.31559283,   -0.09219062,
      0.3104727,    -0.13475694, -0.6489179,  0.40765426,   -0.14116016,
      0.86180204,   0.6627255,   0.1571705,   0.5356045,    0.103602305,
      0.17960587,   0.49856997,  1.9265591,   -0.113237806, 0.84214747,
      0.54692334,   -0.48253217, 1.533446,    -0.88926864,  2.8953416,
      -2.022487,    -2.1422625,  -0.45705467, 0.26532492,   0.12462137,
      -1.0073725,   1.0095638,   -0.28189024, 0.47143045,   2.502574};
  const int32_t axis = 1;
  ONNC_RUNTIME_gather_float(nullptr, input_0, input_0_ndim, input_0_dims,
                            input_1, input_1_ndim, input_1_dims, output_0,
                            output_0_ndim, output_0_dims, axis);
  ASSERT_TRUE(relative_error(output_0, answer_0, 90) < 1e-5f);
}
