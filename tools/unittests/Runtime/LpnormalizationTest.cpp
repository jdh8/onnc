#if defined(__GNUC__) || defined(_MSC_VER)
#define restrict __restrict
#else
#define restrict
#endif

extern "C" {
#include <onnc/Runtime/onnc-runtime.h>
}

#undef restrict

#include "relative-error.hpp"
#include <skypat/skypat.h>
SKYPAT_F(Operator_LpNormalization, l2norm) {
  const float input_0[] = {
      1.1175216,    -0.51942044, 2.571754,    -0.9366709,  1.2007225,
      -1.3413244,   -1.609809,   0.33705035,  -1.2565403,  -0.18516159,
      1.8040843,    0.9445338,   -0.2528019,  0.2173029,   0.1803199,
      0.27361166,   -0.1097027,  -1.8101604,  0.92519176,  0.28909796,
      -0.23947626,  -0.805237,   0.35946044,  -0.41554216, 1.7925867,
      0.93353194,   0.8994958,   -1.3503506,  -0.6021901,  -0.49763682,
      0.26151073,   1.0904778,   2.1488676,   1.7426354,   1.1386721,
      0.70264053,   0.9165149,   -0.19503272, 1.4895556,   -1.0796909,
      -0.49936023,  0.17240871,  0.25892392,  -1.2552617,  -0.38097095,
      1.101627,     -0.41642442, 0.15246066,  -0.819039,   0.19366129,
      1.3620553,    0.1590548,   -1.101053,   1.2635862,   1.4392762,
      0.3739072,    1.2780789,   0.029049773, 0.2896735,   0.36339042,
      0.34813052,   0.31893268,  0.19361551,  -0.58087957, -0.03922886,
      -1.2037386,   1.1714618,   0.93632644,  0.82148105,  -0.8224345,
      -0.49275178,  -0.66978633, -1.2860113,  1.53235,     1.4396085,
      0.01040848,   -0.895511,   0.672653,    0.8517419,   -1.9694375,
      0.42418662,   -0.32402515, -0.51719016, 0.51609945,  -0.122636765,
      0.30978525,   0.5969254,   -0.46417028, 1.0068482,   -0.13400504,
      0.7824943,    1.582653,    1.1381506,   0.49466008,  -1.8870064,
      -1.8067765,   0.028840367, 0.71045876,  -0.64669615, -1.1773775,
      -0.029175477, 1.070526,    1.1749785,   -0.2569484,  0.035655458,
      -0.3668128,   0.5412437,   -1.057329,   0.50390553,  0.53808796,
      1.1150286,    -0.421501,   1.9409523,   -0.9462518,  0.036687996,
      1.1989973,    -1.3275206,  -0.17011431, 0.38191357,  1.2447263};
  const int32_t input_0_ndim = 5;
  const int32_t input_0_dims[] = {1, 2, 3, 4, 5};
  float output_0[120];
  const int32_t output_0_ndim = 5;
  const int32_t output_0_dims[] = {1, 2, 3, 4, 5};
  const float answer_0[] = {
      0.34567133,   -0.16066691,  0.7954939,    -0.28973067, 0.37140697,
      -0.5423127,   -0.65086406,  0.13627328,   -0.5080335,  -0.07486293,
      0.87096846,   0.45599818,   -0.122046664, 0.10490861,  0.0870541,
      0.13189918,   -0.052884057, -0.8726187,   0.44600448,  0.1393646,
      -0.11656128,  -0.39193633,  0.17496167,   -0.20225856, 0.8725132,
      0.46023688,   0.44345683,   -0.665731,    -0.29688334, -0.24533795,
      0.08184803,   0.34129944,   0.6725559,    0.5454127,   0.35638338,
      0.32218173,   0.4202495,    -0.089428335, 0.6830058,   -0.4950706,
      -0.34733552,  0.11992078,   0.18009739,   -0.8731111,  -0.26498854,
      0.75685674,   -0.28609833,  0.10474587,   -0.5627088,  0.13305216,
      0.5238296,    0.061170507,  -0.42345133,  0.4859596,   0.5535278,
      0.2650492,    0.9059835,    0.020592324,  0.20533898,  0.2575942,
      0.44967452,   0.41196015,   0.25009,      -0.7503127,  -0.05067128,
      -0.5356966,   0.5213326,    0.41669092,   0.36558157,  -0.36600587,
      -0.1894385,   -0.25749946,  -0.49440727,  0.58911216,  0.5534577,
      0.0043001953, -0.36997452,  0.27790222,   0.3518916,   -0.81366026,
      0.46454012,   -0.35485014,  -0.5663912,   0.56519675,  -0.13430338,
      0.23763348,   0.45789608,   -0.35606083,  0.77234423,  -0.10279406,
      0.27296016,   0.5520823,    0.39702496,   0.17255397,  -0.6582509,
      -0.76524955,  0.012215167,  0.30091062,   -0.27390435, -0.4986713,
      -0.018112175, 0.664584,     0.72942823,   -0.15951392, 0.022134956,
      -0.2537965,   0.37448457,   -0.73156226,  0.34865046,  0.37230116,
      0.45201853,   -0.17087118,  0.7868376,    -0.38359854, 0.014872851,
      0.5403276,    -0.59824663,  -0.076661944, 0.1721092,   0.56093544};
  const int32_t axis = -1;
  const int32_t p = 2;
  ONNC_RUNTIME_lpnormalization_float(nullptr, input_0, input_0_ndim,
                                     input_0_dims, output_0, output_0_ndim,
                                     output_0_dims, axis, p);
  ASSERT_TRUE(relative_error(output_0, answer_0, 120) < 1e-5f);
}

SKYPAT_F(Operator_LpNormalization, l1norm) {
  const float input_0[] = {
      0.8923633,   -1.4059792,    -1.2887828,    -0.6926536,  0.4426287,
      1.613278,    -0.15182762,   -0.7630771,    -0.9510044,  -0.11409558,
      -0.64644444, 0.4662849,     0.8718602,     -0.42244196, -0.685373,
      1.7237397,   -0.1736969,    -0.84183824,   -2.0448315,  -0.6033447,
      0.46696174,  -0.4404567,    -0.56887203,   0.4327835,   -0.0492329,
      0.6043224,   -0.570751,     -0.10306425,   0.15351395,  -0.83444375,
      -0.29493004, -0.59699446,   -0.38646126,   -0.7082211,  0.40050027,
      -2.1699216,  0.14009352,    0.5402835,     2.2141263,   -1.5085624,
      -0.03653946, -0.6053188,    -0.6181368,    0.42572412,  -1.3051773,
      -0.03940719, 0.8885246,     -1.7052814,    1.5860758,   0.33414638,
      0.47462735,  0.20810261,    -0.0055673574, 2.7131393,   0.5830772,
      -1.4610115,  -1.7672758,    -0.8444104,    1.6343035,   -0.4134745,
      0.04802273,  0.72968686,    -0.6688035,    1.5787531,   0.4072171,
      -1.5071741,  -0.6328217,    0.22747317,    -0.75068843, -0.4716716,
      -0.2293233,  0.69091904,    -0.3460021,    0.7151416,   0.4241243,
      -1.2862537,  -0.95309407,   -1.7616334,    0.6309687,   -1.1749474,
      -0.7742671,  -1.7655678,    -0.644661,     1.4446235,   2.0854833,
      -1.000026,   -0.0063727754, -0.81948286,   -2.7526238,  0.38453525,
      -0.25020263, -0.5640065,    -1.0552557,    1.0784032,   1.5417447,
      -0.2560896,  0.8899806,     0.10042231,    -0.10597098, 0.26502424,
      -0.48121458, 0.30915466,    0.094725125,   0.06466426,  -0.07298599,
      0.82555765,  -0.8234284,    -1.1741451,    0.13195717,  0.6710804,
      0.3835931,   3.267435,      0.15522063,    0.21274757,  0.75387436,
      -0.3541227,  0.0473741,     0.157798,      2.5801666,   -0.40330935};
  const int32_t input_0_ndim = 5;
  const int32_t input_0_dims[] = {1, 2, 3, 4, 5};
  float output_0[120];
  const int32_t output_0_ndim = 5;
  const int32_t output_0_dims[] = {1, 2, 3, 4, 5};
  const float answer_0[] = {
      0.6392908,    -0.5734584,   -0.5205538,    -0.44653875,  0.24631003,
      0.7147863,    -0.09423829,  -0.2967529,    -0.35345516,  -0.08895054,
      -0.45652798,  0.36675438,   0.6898235,     -0.1099021,   -0.4106611,
      0.32191318,   -0.083465345, -0.3780939,    -0.34697792,  -0.23891228,
      0.3345323,    -0.17964958,  -0.22977379,   0.27900612,   -0.02739668,
      0.2677538,    -0.35426098,  -0.040080633,  0.057055783,  -0.65054417,
      -0.20828366,  -0.46956342,  -0.30577156,   -0.18425013,  0.23997134,
      -0.40523887,  0.06731815,   0.24265695,    0.37570477,   -0.5973602,
      -0.02617694,  -0.24689208,  -0.24967238,   0.2744551,    -0.7262933,
      -0.017459927, 0.5515007,    -0.6631665,    0.58948904,   0.26050526,
      0.3351884,    0.16368221,   -0.0044049425, 0.70584774,   0.3493676,
      -0.27284795,  -0.8492166,   -0.37924913,   0.27731732,   -0.16372754,
      0.036841247,  0.26019272,   -0.4749385,    0.5112475,    0.15871663,
      -0.4522303,   -0.43266222,  0.102414586,   -0.20650147,  -0.30882967,
      -0.2656914,   0.1527784,    -0.22229804,   0.35644934,   0.15594277,
      -0.67823714,  -0.50416285,  -0.87215894,   0.1902166,    -0.6374217,
      -0.59398884,  -0.6295685,   -0.45779416,   0.4678123,    0.81283647,
      -0.3000596,   -0.004357087, -0.3689534,    -0.75719947,  0.25177664,
      -0.28988194,  -0.12471506,  -0.6779764,    0.5375105,    0.5668714,
      -0.13503516,  0.47077742,   0.049717616,   -0.031946816, 0.14377853,
      -0.3691699,   0.11023878,   0.067267306,   0.020940222,  -0.028446967,
      0.24771005,   -0.56298065,  -0.5286319,    0.036299147,  0.4393937,
      0.4444267,    0.7225065,    0.09972553,    0.106040165,  0.27718586,
      -0.18672767,  0.025059711,  0.07812349,    0.77783656,   -0.21879971};
  const int32_t axis = 2;
  const int32_t p = 1;
  ONNC_RUNTIME_lpnormalization_float(nullptr, input_0, input_0_ndim,
                                     input_0_dims, output_0, output_0_ndim,
                                     output_0_dims, axis, p);
  ASSERT_TRUE(relative_error(output_0, answer_0, 120) < 1e-5f);
}
