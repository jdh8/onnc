#if defined(__GNUC__) || defined(_MSC_VER)
#define restrict __restrict
#else
#define restrict
#endif

extern "C" {
#include <onnc/Runtime/onnc-runtime.h>
}

#undef restrict

#include "relative-error.hpp"
#include <skypat/skypat.h>
SKYPAT_F(Operator_GlobalLpPool, l2norm) {
  const float input_0[] = {
      0.6230745,   -1.6225305,  -1.7401248,   0.81599516,   -0.30705327,
      -0.3069158,  -0.31298202, -1.7505534,   -0.12871352,  0.40099916,
      -0.07210505, -1.9109485,  -0.7127568,   -0.19791628,  1.0137707,
      1.1807835,   1.1534718,   1.5591861,    0.09680083,   2.5871596,
      -0.48672497, 0.13656548,  -2.4358146,   0.92024034,   0.07578854,
      0.24291493,  0.32685253,  -0.26931086,  -0.8874282,   -0.36028522,
      0.06855079,  -0.51325625, -0.6384037,   0.7775848,    1.1484246,
      -0.5124967,  0.31174922,  -0.44168973,  -0.15833557,  1.4963828,
      1.6627162,   1.499049,    2.0237288,    -0.6546197,   0.77485096,
      -0.30152944, 1.0913472,   0.8854416,    -0.74474883,  -0.1245811,
      -0.26531515, 0.4313541,   0.40339693,   -0.5097587,   -0.74384916,
      0.042914297, -0.9136621,  1.2416,       -1.1105802,   1.5197272,
      1.7971326,   0.19241694,  1.7995608,    0.10907397,   -0.24237564,
      0.51356924,  0.82913756,  1.6258212,    -1.2830813,   1.9447182,
      1.0115085,   -2.71382,    -0.51953554,  -0.2916531,   0.9778039,
      -0.33830634, 1.5913441,   0.7784269,    -1.0646801,   -1.0373471,
      -0.80609155, -0.61985016, 0.6565757,    -1.043992,    -0.8088312,
      0.9733276,   -1.9163504,  -1.1168425,   -0.13813409,  -0.43044516,
      -1.465387,   -0.35709476, 1.053607,     0.80032885,   -1.4292388,
      -0.6583043,  -0.18780386, 0.96012616,   0.26125988,   -1.2581663,
      -0.07890913, 1.1978374,   -1.4350659,   -1.3198174,   0.8362476,
      0.20288113,  0.4926931,   -0.058589585, 1.2082049,    -0.24432148,
      0.69885457,  0.7088058,   -2.1695979,   -0.04551417,  -0.42708835,
      2.3306854,   -0.6411096,  0.9902173,    -0.073990345, -0.58949023};
  const int32_t input_0_ndim = 5;
  const int32_t input_0_dims[] = {1, 2, 3, 4, 5};
  float output_0[2];
  const int32_t output_0_ndim = 5;
  const int32_t output_0_dims[] = {1, 2, 1, 1, 1};
  const float answer_0[] = {7.802217, 8.364097};
  const int32_t p = 2;
  ONNC_RUNTIME_globallppool_float(nullptr, input_0, input_0_ndim, input_0_dims,
                                  output_0, output_0_ndim, output_0_dims, p);
  ASSERT_TRUE(relative_error(output_0, answer_0, 2) < 1e-5f);
}

SKYPAT_F(Operator_GlobalLpPool, l3norm) {
  const float input_0[] = {
      -0.47156513,  0.6761152,    1.2831161,   0.14258909,   1.903007,
      0.35003528,   0.35492152,   -0.55207264, 0.7748647,    0.25792146,
      -0.21315552,  0.1787243,    0.14380805,  0.5175982,    1.7719754,
      0.39830682,   -0.4784085,   0.17659734,  -0.7088697,   0.10913184,
      0.7694211,    0.022185538,  -1.0539397,  -0.6617983,   -0.30498433,
      1.7833993,    -1.0212255,   -0.42389014, 1.4457456,    -0.1285027,
      0.56096655,   2.1963973,    0.40646857,  0.7559724,    0.26129004,
      0.49417093,   -0.92391723,  0.22643702,  -0.069402024, -0.44986,
      1.9229883,    0.07393445,   0.50213104,  0.9045783,    0.43238124,
      -0.52373916,  1.7149414,    -1.7917427,  0.9155958,    -0.76097375,
      -1.3424995,   -0.18359733,  -0.44198734, -0.06801736,  -1.0169648,
      -0.2803407,   1.9007331,    -0.30623522, -1.4013208,   0.44592205,
      -0.017836088, -0.87534755,  1.137238,    -2.4519658,   1.7800846,
      0.48419687,   0.08542601,   -0.29163527, -0.6197528,   1.2424341,
      -0.40008903,  -0.037160236, 1.2906189,   -0.3269842,   1.5846586,
      0.8018598,    0.8749821,    0.8741467,   0.81373453,   0.49237964,
      0.066146836,  -0.41177154,  -0.58827525, 1.3660992,    0.78278536,
      0.5249554,    -0.32833052,  2.2843642,   1.126044,     -1.3554281,
      1.2139302,    -0.4500176,   -0.64625216, -0.38306212,  -1.4241449,
      -0.119250424, 0.84389335,   0.8673232,   -1.1135725,   -1.7871981,
      1.4637665,    0.42484748,   0.76013464,  2.6068492,    -0.72265047,
      1.4752481,    0.5586717,    1.3731673,   -0.7698329,   1.7726127,
      -0.10898397,  0.15404737,   1.0178196,   -0.66891664,  0.3423269,
      0.7366501,    -1.7016673,   -1.0120469,  0.75733256,   -0.77387947};
  const int32_t input_0_ndim = 5;
  const int32_t input_0_dims[] = {1, 2, 3, 4, 5};
  float output_0[2];
  const int32_t output_0_ndim = 5;
  const int32_t output_0_dims[] = {1, 2, 1, 1, 1};
  const float answer_0[] = {4.19887, 4.772824};
  const int32_t p = 3;
  ONNC_RUNTIME_globallppool_float(nullptr, input_0, input_0_ndim, input_0_dims,
                                  output_0, output_0_ndim, output_0_dims, p);
  ASSERT_TRUE(relative_error(output_0, answer_0, 2) < 1e-5f);
}

SKYPAT_F(Operator_GlobalLpPool, l1norm) {
  const float input_0[] = {
      0.79287434,   -0.06458996, -0.27388597, 0.7086449,   -0.5962552,
      0.49200153,   -1.5316726,  -1.4546926,  -2.1281013,  -0.41472346,
      -0.03411469,  -1.8096606,  -0.0808411,  -1.3904107,  -1.776548,
      0.8610813,    0.7720117,   -0.36771417, -0.6017723,  1.3940164,
      -1.3415103,   1.8342972,   0.75170153,  0.17301674,  0.0048365057,
      0.8683819,    -2.4792352,  1.5764433,   -0.7123437,  0.71617925,
      1.3263531,    -1.2168777,  -0.83558863, 0.82570684,  -0.91079545,
      -0.21823433,  1.612091,    -1.925601,   0.7312916,   0.841971,
      0.7463063,    -0.45957255, -1.3050776,  0.6453866,   -2.2235723,
      0.14656103,   1.2659118,   0.49635565,  0.022821348, -1.1140844,
      0.29255894,   -1.6320636,  0.6003014,   -0.7114355,  0.9867471,
      1.1242867,    2.0029979,   1.0360577,   -0.43843046, 0.46006003,
      0.12410841,   -0.37307638, 0.7963888,   0.41352576,  -0.0077231647,
      -0.08527495,  0.43790105,  -0.9665,     1.6057041,   -1.2732216,
      -0.48282605,  0.9240941,   1.260165,    -0.5558141,  -0.17282654,
      0.5433549,    0.17883001,  0.83699363,  0.9041493,   0.37868762,
      -0.3097702,   0.36110127,  0.5849438,   0.84907717,  0.73884666,
      -0.072787546, 0.13730271,  0.9932586,   -0.20041658, -1.3770148,
      -0.2657291,   -1.579252,   1.1320877,   2.169916,    -1.3792456,
      0.9000371,    -1.1377388,  0.68822074,  -1.7740989,  -0.108470015,
      -1.3208724,   0.5805,      0.4742664,   0.31897616,  -0.09277382,
      -0.26395127,  0.32457095,  -0.8860402,  -1.4375876,  0.56563485,
      0.5955349,    0.49853945,  0.89172596,  -0.25511178, 0.7615826,
      0.79947513,   -0.12388657, 0.31208858,  -0.63426393, -1.2604367};
  const int32_t input_0_ndim = 5;
  const int32_t input_0_dims[] = {1, 2, 3, 4, 5};
  float output_0[2];
  const int32_t output_0_ndim = 5;
  const int32_t output_0_dims[] = {1, 2, 1, 1, 1};
  const float answer_0[] = {56.158665, 41.478302};
  const int32_t p = 1;
  ONNC_RUNTIME_globallppool_float(nullptr, input_0, input_0_ndim, input_0_dims,
                                  output_0, output_0_ndim, output_0_dims, p);
  ASSERT_TRUE(relative_error(output_0, answer_0, 2) < 1e-5f);
}
