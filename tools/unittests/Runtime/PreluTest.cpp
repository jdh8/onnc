#if defined(__GNUC__) || defined(_MSC_VER)
#define restrict __restrict
#else
#define restrict
#endif

extern "C" {
#include <onnc/Runtime/onnc-runtime.h>
}

#undef restrict

#include "relative-error.hpp"
#include <skypat/skypat.h>
SKYPAT_F(Operator_PRelu, test_prelu_example) {
  const float input_0[] = {
      -2.6549647,   -0.624724,    -3.019288,   -0.890886,   -1.0350527,
      -0.011905926, 0.25039914,   -0.22184968, 0.92224276,  -0.9760848,
      1.9044952,    -0.9279544,   -0.2829805,  0.3702449,   1.1239767,
      0.032991346,  -0.032815862, 1.1998488,   0.21551338,  -0.39434114,
      2.533884,     1.4883496,    0.22250766,  0.5693397,   0.8613437,
      -2.0092597,   -1.2012097,   0.44509894,  -1.4330465,  0.8475616,
      -0.12279123,  2.3562365,    1.3090521,   0.75257075,  2.355051,
      0.40471804,   -0.23795092,  -1.5891734,  -0.13188434, 0.60384285,
      -0.48663312,  -0.2004275,   -1.7070101,  -0.64646626, -0.4694052,
      0.9470975,    1.4062393,    0.21112603,  -0.24911076, 0.5348674,
      -0.54203534,  -0.80552405,  0.73372936,  -0.6274473,  0.16021295,
      -0.81314945,  -0.18342343,  -1.7427949,  -0.8902952,  0.9308157};
  const int32_t input_0_ndim = 3;
  const int32_t input_0_dims[] = {3, 4, 5};
  const float input_1[] = {
      0.22965537,  -0.3105668,   -2.1792963,   -0.72802585,  0.14560045,
      -0.9548592,  -0.7103509,   -0.34865612,  0.42077628,   0.93577707,
      -0.17044872, 0.0004397188, -0.4858761,   -0.021723118, 0.08699149,
      -0.6215847,  0.40775892,   -1.0487987,   0.18077235,   1.1783986,
      -1.1668527,  0.16566364,   -0.39395654,  0.36252502,   0.6332773,
      0.268592,    -0.5063387,   1.0063941,    1.5343249,    -0.043969434,
      0.12378082,  -0.5984176,   -1.2298908,   -0.18093029,  0.9649766,
      -0.14357206, -0.25406858,  -1.3278542,   1.0270023,    -0.3875204,
      1.3711243,   0.9754538,    2.3255029,    0.21027277,   0.28729436,
      -0.23395373, -0.02752416,  -0.79909074,  1.4155573,    -0.8411986,
      0.2746294,   -0.5870433,   0.41080663,   -1.2031326,   1.3553758,
      -0.5369141,  -0.84133005,  -0.114930704, -1.5445766,   -0.04675246};
  const int32_t input_1_ndim = 3;
  const int32_t input_1_dims[] = {3, 4, 5};
  float output_0[60];
  const int32_t output_0_ndim = 3;
  const int32_t output_0_dims[] = {3, 4, 5};
  const float answer_0[] = {
      -0.6097269,   0.19401853,   6.579923,    0.64858806,  -0.15070413,
      0.011368483,  0.25039914,   0.077349246, 0.92224276,  -0.9133978,
      1.9044952,    -0.000408039, 0.13749346,  0.3702449,   1.1239767,
      0.032991346,  -0.013380961, 1.1998488,   0.21551338,  -0.46469104,
      2.533884,     1.4883496,    0.22250766,  0.5693397,   0.8613437,
      -0.53967106,  0.60821897,   0.44509894,  -2.1987588,  0.8475616,
      -0.015199198, 2.3562365,    1.3090521,   0.75257075,  2.355051,
      0.40471804,   0.060455855,  2.1101906,   -0.13544552, 0.60384285,
      -0.6672345,   -0.19550776,  -3.969657,   -0.13593425, -0.13485746,
      0.9470975,    1.4062393,    0.21112603,  -0.35263056, 0.5348674,
      -0.14885885,  0.47287747,   0.73372936,  0.7549023,   0.16021295,
      0.43659142,   0.15431964,   0.20030065,  1.3751292,   0.9308157};
  ONNC_RUNTIME_prelu_float(nullptr, input_0, input_0_ndim, input_0_dims,
                           input_1, input_1_ndim, input_1_dims, output_0,
                           output_0_ndim, output_0_dims);
  ASSERT_TRUE(relative_error(output_0, answer_0, 60) < 1e-5f);
}

SKYPAT_F(Operator_PRelu, test_prelu_broadcast) {
  const float input_0[] = {
      0.23683342,   0.40404552,  -0.30891925, -0.1869117,  0.0030262412,
      -1.2013334,   0.12127367,  1.7400681,   -0.6713519,  -1.0620186,
      0.6015863,    -0.7980335,  0.06849786,  -0.19868392, -0.5559846,
      0.89453983,   -0.75484717, -2.1106095,  -1.6419078,  0.27785155,
      0.61100495,   -2.2137742,  1.0810797,   0.3741164,   0.540717,
      -0.095624015, 0.20263505,  -0.5837504,  0.061520755, 0.88455933,
      -0.6553291,   0.97709954,  -0.5775341,  -1.0189694,  3.1586144,
      -0.35003906,  1.7430416,   -0.14940226, -0.5764971,  -0.04828939,
      -2.018202,    1.0186427,   0.30558753,  0.12909663,  1.3766644,
      -0.3914709,   0.16375463,  -0.7162445,  1.5918199,   -1.2099588,
      0.26406863,   -0.5774824,  1.609823,    -0.24841931, 0.1608056,
      -0.37391984,  -0.49248126, 0.8604952,   -0.26640046, 0.8561154};
  const int32_t input_0_ndim = 3;
  const int32_t input_0_dims[] = {3, 4, 5};
  const float input_1[] = {1.3842324, -0.14571361, 0.8403254, -0.0135856755,
                           0.36779127};
  const int32_t input_1_ndim = 1;
  const int32_t input_1_dims[] = {5};
  float output_0[60];
  const int32_t output_0_ndim = 3;
  const int32_t output_0_dims[] = {3, 4, 5};
  const float answer_0[] = {
      0.23683342,  0.40404552,  -0.2595927,  0.0025393218, 0.0030262412,
      -1.6629246,  0.12127367,  1.7400681,   0.009120769,  -0.3906012,
      0.6015863,   0.11628434,  0.06849786,  0.0026992552, -0.20448628,
      0.89453983,  0.109991506, -1.7735988,  0.022306427,  0.27785155,
      0.61100495,  0.32257703,  1.0810797,   0.3741164,    0.540717,
      -0.13236585, 0.20263505,  -0.49054033, 0.061520755,  0.88455933,
      -0.9071278,  0.97709954,  -0.48531657, 0.013843388,  3.1586144,
      -0.48453543, 1.7430416,   -0.12554651, 0.0078321025, -0.017760415,
      -2.7936606,  1.0186427,   0.30558753,  0.12909663,   1.3766644,
      -0.5418867,  0.16375463,  -0.60187846, 1.5918199,    -0.44501227,
      0.26406863,  0.08414704,  1.609823,    0.0033749442, 0.1608056,
      -0.51759195, 0.07176122,  0.8604952,   0.0036192301, 0.8561154};
  ONNC_RUNTIME_prelu_float(nullptr, input_0, input_0_ndim, input_0_dims,
                           input_1, input_1_ndim, input_1_dims, output_0,
                           output_0_ndim, output_0_dims);
  ASSERT_TRUE(relative_error(output_0, answer_0, 60) < 1e-5f);
}
