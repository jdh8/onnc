#if defined(__GNUC__) || defined(_MSC_VER)
#define restrict __restrict
#else
#define restrict
#endif

extern "C" {
#include <onnc/Runtime/onnc-runtime.h>
}

#undef restrict

#include "relative-error.hpp"
#include <skypat/skypat.h>
SKYPAT_F(Operator_LpPool, l2norm) {
  const float input_0[] = {
      0.79465723,   -0.0028489952, 1.8480387,    -1.2996508,  0.6134822,
      1.3036358,    -0.59131587,   -1.030862,    -0.59943503, 1.9841248,
      -0.6476785,   -0.19091606,   -0.69143564,  -0.37526035, -1.9535247,
      1.0592228,    -0.6933048,    1.7340347,    -0.7767662,  -0.49181953,
      -0.47888768,  -0.004576624,  0.7931744,    -0.26847377, 1.5296246,
      1.6573496,    -0.22337058,   0.34523684,   -0.33636406, -1.0281622,
      0.43170795,   2.7770536,     0.48759067,   0.5654238,   -0.11518474,
      -1.208983,    0.16204683,    -1.2480161,   0.32765785,  -0.02925416,
      -0.5281789,   -0.4818364,    0.8575155,    0.74841076,  -1.0210232,
      -0.058408972, 1.0988555,     -0.6207359,   -0.5595229,  -2.2834997,
      -0.30956915,  0.47155946,    -1.9895449,   -0.859041,   0.43697035,
      0.58788484,   -0.89661884,   -0.57915604,  0.35224283,  1.4426143,
      -0.50292486,  -0.7397549,    -1.0040646,   -2.3951035,  -0.2264156,
      -0.7543793,   -1.048674,     -1.7546644,   -1.1327825,  0.70835465,
      -2.1520982,   1.9049498,     -1.2802792,   1.7263954,   -0.059222814,
      -0.015186327, 0.32526416,    0.732974,     -0.25856775, 0.40104702,
      -0.18475935,  -1.0510607,    0.09093519,   -0.6403353,  0.62543684,
      -0.3333218,   -0.13749969,   -1.0394068,   0.02552852,  0.42420572,
      -0.22477156,  1.0633625,     0.68555725,   -0.7680728,  0.7465114,
      -1.2412317,   0.113495976,   -0.32180116,  2.4108753,   1.7208816,
      0.42703047,   1.0833325,     0.0015552491, -1.5408767,  -0.33062288,
      1.266821,     -0.57654214,   1.9791081,    0.5738424,   0.8788863,
      0.47170085,   -0.16178274,   -1.0252488,   0.21280456,  -0.48560414,
      -0.21002184,  -0.29788038,   -1.6164472,   2.2834144,   1.088657};
  const int32_t input_0_ndim = 5;
  const int32_t input_0_dims[] = {1, 2, 3, 4, 5};
  float output_0[48];
  const int32_t output_0_ndim = 5;
  const int32_t output_0_dims[] = {1, 2, 2, 3, 4};
  const float answer_0[] = {
      2.3888626, 2.37188,   2.7312765, 3.1533496, 3.633202,  3.169498,
      1.6824626, 3.1235209, 3.383025,  3.6790833, 2.53998,   2.2898731,
      2.1790113, 1.8326279, 1.7109541, 3.2729392, 3.496312,  3.7272387,
      2.4868448, 2.8212693, 3.294546,  3.854034,  2.7162638, 1.8908445,
      1.9333521, 2.8189037, 3.5504966, 2.9248161, 3.352676,  3.485185,
      3.3350475, 2.4691553, 3.3318446, 2.7619128, 3.4927733, 3.6238947,
      2.1359015, 2.7631779, 2.8495235, 2.1370895, 1.8700757, 2.833122,
      2.7356038, 1.6464053, 1.7653092, 2.3443782, 3.987368,  4.0744596};
  const int32_t kernel_shape[] = {2, 2, 2};
  const int32_t number_of_kernel_shape = 3;
  const int32_t strides[] = {1, 1, 1, 1, 1};
  const int32_t number_of_strides = 5;
  const char auto_pad[] = "NOTSET";
  const int32_t pads[] = {0, 0, 0, 0, 0, 0, 0, 0, 0, 0};
  const int32_t number_of_pads = 10;
  const int32_t p = 2;
  ONNC_RUNTIME_lppool_float(
      nullptr, input_0, input_0_ndim, input_0_dims, output_0, output_0_ndim,
      output_0_dims, auto_pad, const_cast<int32_t *>(kernel_shape),
      number_of_kernel_shape, p, const_cast<int32_t *>(pads), number_of_pads,
      const_cast<int32_t *>(strides), number_of_strides);
  ASSERT_TRUE(relative_error(output_0, answer_0, 48) < 1e-5f);
}

SKYPAT_F(Operator_LpPool, l3norm) {
  const float input_0[] = {
      0.28458598,  1.5203505,    0.11629148,  -1.4874195,  -0.48053017,
      -0.46045566, 0.9134447,    -0.34336653, 0.2492745,   -0.26981634,
      -0.16764073, -0.8173477,   -1.0983102,  0.18736234,  -1.6584513,
      0.28641027,  -0.35209107,  -0.7536326,  -1.5075687,  -2.4205441,
      0.8482883,   -1.4191717,   -0.30421436, 0.28897604,  0.7388833,
      1.0660194,   0.72359437,   -0.67561144, 0.04123005,  1.0433646,
      -0.9274718,  -0.044655435, 2.6765354,   -1.8841593,  -0.7041431,
      0.3612759,   0.78539044,   0.49670264,  1.4245003,   -0.42398998,
      0.099413075, -1.2599362,   0.60959065,  -0.37413484, 0.4379427,
      -0.45721942, 1.248265,     0.40339878,  0.7910733,   -0.5771513,
      -0.61932445, 0.22560643,   2.272054,    -0.04175655, 2.4616096,
      -0.726,      0.518974,     -1.7991112,  0.59236974,  -1.0381559,
      -0.03343603, -0.13873559,  0.004754319, -0.84296346, -0.25803077,
      -0.857036,   -0.62738293,  -0.28840315, 0.11747358,  1.3031904,
      1.0875313,   0.47805914,   -0.51057225, 1.150029,    0.8299223,
      2.1619473,   1.4337862,    1.5735779,   -0.7683315,  -0.80784523,
      -1.2800754,  -1.5914433,   0.17090954,  0.95025545,  -1.8300157,
      -0.24474928, 1.3920234,    1.9880688,   1.6182482,   0.51642793,
      -0.7388162,  0.26246506,   -0.92970705, 0.18908882,  0.69233596,
      -1.3683923,  1.1097159,    1.4904289,   1.1406069,   -0.28785503,
      -1.2843927,  0.18164925,   0.87894267,  -0.7141325,  -0.12294316,
      -0.31876653, -0.58021,     0.1739015,   -0.8757928,  0.59900343,
      -0.06197349, -0.09752374,  -0.3403232,  1.9161488,   -1.3786498,
      0.7293525,   -2.332918,    0.56633985,  0.8333224,   0.4686409};
  const int32_t input_0_ndim = 5;
  const int32_t input_0_dims[] = {1, 2, 3, 4, 5};
  float output_0[48];
  const int32_t output_0_ndim = 5;
  const int32_t output_0_dims[] = {1, 2, 2, 3, 4};
  const float answer_0[] = {
      2.1146417, 1.9909708, 1.547944,  1.7100095, 1.5603161, 2.8245783,
      3.0205634, 2.3378184, 1.2487787, 2.8072922, 3.2415838, 3.1807866,
      2.0878077, 1.9841183, 1.0627561, 1.3364588, 1.6724284, 3.2272608,
      3.375523,  2.875555,  1.2807791, 3.3467143, 3.5994973, 2.9718788,
      2.1340876, 2.4587512, 2.3859773, 2.4211788, 1.7549888, 2.282412,
      2.4432821, 2.081743,  2.6589227, 2.3260632, 2.2642972, 1.7007817,
      2.2368922, 2.4920423, 2.4484766, 2.327885,  1.4981115, 2.26485,
      2.743847,  2.480191,  2.5930943, 2.6408718, 2.377581,  2.301054};
  const int32_t kernel_shape[] = {2, 2, 2};
  const int32_t number_of_kernel_shape = 3;
  const int32_t p = 3;
  const int32_t strides[] = {1, 1, 1, 1, 1};
  const int32_t number_of_strides = 5;
  const char auto_pad[] = "NOTSET";
  const int32_t pads[] = {0, 0, 0, 0, 0, 0, 0, 0, 0, 0};
  const int32_t number_of_pads = 10;
  ONNC_RUNTIME_lppool_float(
      nullptr, input_0, input_0_ndim, input_0_dims, output_0, output_0_ndim,
      output_0_dims, auto_pad, const_cast<int32_t *>(kernel_shape),
      number_of_kernel_shape, p, const_cast<int32_t *>(pads), number_of_pads,
      const_cast<int32_t *>(strides), number_of_strides);
  ASSERT_TRUE(relative_error(output_0, answer_0, 48) < 1e-5f);
}

SKYPAT_F(Operator_LpPool, l1norm) {
  const float input_0[] = {
      -0.13011529,  1.6808261,   0.6579832,    -0.9618801,  -0.18975191,
      2.1630259,    0.21110544,  -0.39624178,  1.500987,    -0.103345424,
      0.5412069,    -1.7625736,  -0.73323154,  -0.95397145, -0.74462295,
      -0.43422478,  0.72925264,  -0.80488825,  -0.0445641,  -0.97880095,
      1.5591141,    -0.60718155, 1.089975,     0.13500169,  0.61137515,
      0.40898734,   -1.3666244,  2.1600108,    1.5315603,   0.5968614,
      0.8035046,    0.4423191,   -0.12274524,  -0.6999816,  0.072846025,
      -0.43120363,  -0.24348654, -0.46510285,  -2.458703,   -0.31032792,
      0.079705425,  -0.45430097, 0.97955596,   -1.6568961,  1.0659865,
      0.18658565,   -0.1620458,  1.1479253,    -0.24598514, -0.95282584,
      1.6572177,    -0.22434673, 0.86323285,   0.2963473,   0.3540872,
      -1.9369824,   -1.6311761,  -1.5351855,   -0.3438768,  0.14252812,
      -1.0072294,   -0.48574355, 0.8175635,    -0.28243858, -0.98988503,
      -0.8243152,   0.07195722,  0.74724704,   1.0781143,   -0.1814191,
      -0.009299293, 0.34226722,  -0.038295742, -0.6666056,  -2.2795486,
      -0.9277507,   1.8292731,   -0.35913822,  0.92449063,  -1.9826643,
      0.71897894,   -0.8307411,  0.3050623,    0.5096602,   0.7003292,
      -1.9944533,   -1.5109327,  1.8320554,    1.2525381,   1.2135434,
      -1.2573493,   0.3231406,   1.8353518,    1.1239415,   0.1734547,
      0.2705263,    1.3515084,   -1.9850639,   0.7546469,   1.9084383,
      -1.1389836,   -0.29888272, 0.6999625,    -0.49211448, 1.4085853,
      1.9518511,    0.7598374,   -1.857942,    0.33745015,  0.1867406,
      0.9045596,    -0.56233495, -0.7888985,   0.08192683,  1.4737502,
      -2.0770903,   0.66591686,  0.83084625,   -0.2716141,  -0.10990634};
  const int32_t input_0_ndim = 5;
  const int32_t input_0_dims[] = {1, 2, 3, 4, 5};
  float output_0[48];
  const int32_t output_0_ndim = 5;
  const int32_t output_0_dims[] = {1, 2, 2, 3, 4};
  const float answer_0[] = {
      8.12698,   8.169949,  8.43364,   5.6307626, 7.699347,  7.1948514,
      8.098729,  6.204176,  5.3877716, 5.3035994, 6.283188,  6.263818,
      4.824545,  7.96762,   8.94691,   6.796492,  5.2516313, 6.48925,
      7.0677886, 4.750495,  7.3702364, 5.5275946, 6.785175,  4.678698,
      7.444351,  6.601303,  6.8246794, 6.207928,  6.333715,  6.701248,
      8.57415,   7.9691653, 6.3111143, 8.064038,  7.6875343, 9.81379,
      9.20466,   8.095416,  7.286785,  6.100961,  9.264459,  9.470493,
      9.110105,  5.843345,  7.4124265, 8.343061,  7.67229,   5.8976784};
  const int32_t kernel_shape[] = {2, 2, 2};
  const int32_t number_of_kernel_shape = 3;
  const int32_t p = 1;
  const int32_t strides[] = {1, 1, 1, 1, 1};
  const int32_t number_of_strides = 5;
  const char auto_pad[] = "NOTSET";
  const int32_t pads[] = {0, 0, 0, 0, 0, 0, 0, 0, 0, 0};
  const int32_t number_of_pads = 10;
  ONNC_RUNTIME_lppool_float(
      nullptr, input_0, input_0_ndim, input_0_dims, output_0, output_0_ndim,
      output_0_dims, auto_pad, const_cast<int32_t *>(kernel_shape),
      number_of_kernel_shape, p, const_cast<int32_t *>(pads), number_of_pads,
      const_cast<int32_t *>(strides), number_of_strides);
  ASSERT_TRUE(relative_error(output_0, answer_0, 48) < 1e-5f);
}
