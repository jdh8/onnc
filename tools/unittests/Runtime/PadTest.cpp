#include <cmath>
#include <cstdlib>
#include <ctime>
#include <skypat/skypat.h>
#include <vector>

#define restrict
extern "C" {
#include <onnc/Runtime/onnc-runtime.h>
}
SKYPAT_F(Operator_Pad, test_constant_pad) {
  const float input_0[1][3][4][5] = {
      {{{-0.14658747613430023, -0.27301135659217834, 0.5113937258720398,
         -0.5792500376701355, 1.047516107559204},
        {0.5512264370918274, -1.017577052116394, -0.007638389710336924,
         -1.0670782327651978, -0.8821064233779907},
        {-0.9897992610931396, -0.07148779928684235, 0.134601429104805,
         -0.11080518364906311, 0.42261263728141785},
        {-0.7749271988868713, -0.1325739473104477, 0.30055826902389526,
         0.9774032235145569, 1.3420222997665405}},
       {{1.8233140707015991, 1.183982253074646, 0.9696006178855896,
         1.5045198202133179, 0.4805852174758911},
        {1.3376798629760742, 0.7218688130378723, 0.8219807744026184,
         -1.5109783411026, -0.2014162689447403},
        {1.6841928958892822, -0.9599099159240723, 0.3013925850391388,
         0.03212693706154823, 0.8144524693489075},
        {0.02411675453186035, -0.15951651334762573, 0.8264129161834717,
         -0.43406036496162415, 0.022939618676900864}},
       {{-1.0333250761032104, -0.705048143863678, -0.09045618027448654,
         -0.17387230694293976, -0.17136819660663605},
        {-0.619677722454071, -1.0752980709075928, 1.1977413892745972,
         0.23724226653575897, 0.4227321147918701},
        {-0.8153740167617798, 0.12729088962078094, -1.328209400177002,
         -1.917899489402771, -0.3228563964366913},
        {-0.4738975465297699, -0.7737942934036255, -0.24927717447280884,
         0.49620845913887024, 1.0121490955352783}}}};
  const int32_t input_0_ndim = 4;
  const int32_t input_0_dims[] = {1, 3, 4, 5};
  float output_0[1][3][7][12];
  const int32_t output_0_ndim = 4;
  const int32_t output_0_dims[] = {1, 3, 7, 12};
  const float answer_0[1][3][7][12] = {
      {{{1.2000000476837158, 1.2000000476837158, 1.2000000476837158,
         1.2000000476837158, 1.2000000476837158, 1.2000000476837158,
         1.2000000476837158, 1.2000000476837158, 1.2000000476837158,
         1.2000000476837158, 1.2000000476837158, 1.2000000476837158},
        {1.2000000476837158, 1.2000000476837158, 1.2000000476837158,
         -0.14658747613430023, -0.27301135659217834, 0.5113937258720398,
         -0.5792500376701355, 1.047516107559204, 1.2000000476837158,
         1.2000000476837158, 1.2000000476837158, 1.2000000476837158},
        {1.2000000476837158, 1.2000000476837158, 1.2000000476837158,
         0.5512264370918274, -1.017577052116394, -0.007638389710336924,
         -1.0670782327651978, -0.8821064233779907, 1.2000000476837158,
         1.2000000476837158, 1.2000000476837158, 1.2000000476837158},
        {1.2000000476837158, 1.2000000476837158, 1.2000000476837158,
         -0.9897992610931396, -0.07148779928684235, 0.134601429104805,
         -0.11080518364906311, 0.42261263728141785, 1.2000000476837158,
         1.2000000476837158, 1.2000000476837158, 1.2000000476837158},
        {1.2000000476837158, 1.2000000476837158, 1.2000000476837158,
         -0.7749271988868713, -0.1325739473104477, 0.30055826902389526,
         0.9774032235145569, 1.3420222997665405, 1.2000000476837158,
         1.2000000476837158, 1.2000000476837158, 1.2000000476837158},
        {1.2000000476837158, 1.2000000476837158, 1.2000000476837158,
         1.2000000476837158, 1.2000000476837158, 1.2000000476837158,
         1.2000000476837158, 1.2000000476837158, 1.2000000476837158,
         1.2000000476837158, 1.2000000476837158, 1.2000000476837158},
        {1.2000000476837158, 1.2000000476837158, 1.2000000476837158,
         1.2000000476837158, 1.2000000476837158, 1.2000000476837158,
         1.2000000476837158, 1.2000000476837158, 1.2000000476837158,
         1.2000000476837158, 1.2000000476837158, 1.2000000476837158}},
       {{1.2000000476837158, 1.2000000476837158, 1.2000000476837158,
         1.2000000476837158, 1.2000000476837158, 1.2000000476837158,
         1.2000000476837158, 1.2000000476837158, 1.2000000476837158,
         1.2000000476837158, 1.2000000476837158, 1.2000000476837158},
        {1.2000000476837158, 1.2000000476837158, 1.2000000476837158,
         1.8233140707015991, 1.183982253074646, 0.9696006178855896,
         1.5045198202133179, 0.4805852174758911, 1.2000000476837158,
         1.2000000476837158, 1.2000000476837158, 1.2000000476837158},
        {1.2000000476837158, 1.2000000476837158, 1.2000000476837158,
         1.3376798629760742, 0.7218688130378723, 0.8219807744026184,
         -1.5109783411026, -0.2014162689447403, 1.2000000476837158,
         1.2000000476837158, 1.2000000476837158, 1.2000000476837158},
        {1.2000000476837158, 1.2000000476837158, 1.2000000476837158,
         1.6841928958892822, -0.9599099159240723, 0.3013925850391388,
         0.03212693706154823, 0.8144524693489075, 1.2000000476837158,
         1.2000000476837158, 1.2000000476837158, 1.2000000476837158},
        {1.2000000476837158, 1.2000000476837158, 1.2000000476837158,
         0.02411675453186035, -0.15951651334762573, 0.8264129161834717,
         -0.43406036496162415, 0.022939618676900864, 1.2000000476837158,
         1.2000000476837158, 1.2000000476837158, 1.2000000476837158},
        {1.2000000476837158, 1.2000000476837158, 1.2000000476837158,
         1.2000000476837158, 1.2000000476837158, 1.2000000476837158,
         1.2000000476837158, 1.2000000476837158, 1.2000000476837158,
         1.2000000476837158, 1.2000000476837158, 1.2000000476837158},
        {1.2000000476837158, 1.2000000476837158, 1.2000000476837158,
         1.2000000476837158, 1.2000000476837158, 1.2000000476837158,
         1.2000000476837158, 1.2000000476837158, 1.2000000476837158,
         1.2000000476837158, 1.2000000476837158, 1.2000000476837158}},
       {{1.2000000476837158, 1.2000000476837158, 1.2000000476837158,
         1.2000000476837158, 1.2000000476837158, 1.2000000476837158,
         1.2000000476837158, 1.2000000476837158, 1.2000000476837158,
         1.2000000476837158, 1.2000000476837158, 1.2000000476837158},
        {1.2000000476837158, 1.2000000476837158, 1.2000000476837158,
         -1.0333250761032104, -0.705048143863678, -0.09045618027448654,
         -0.17387230694293976, -0.17136819660663605, 1.2000000476837158,
         1.2000000476837158, 1.2000000476837158, 1.2000000476837158},
        {1.2000000476837158, 1.2000000476837158, 1.2000000476837158,
         -0.619677722454071, -1.0752980709075928, 1.1977413892745972,
         0.23724226653575897, 0.4227321147918701, 1.2000000476837158,
         1.2000000476837158, 1.2000000476837158, 1.2000000476837158},
        {1.2000000476837158, 1.2000000476837158, 1.2000000476837158,
         -0.8153740167617798, 0.12729088962078094, -1.328209400177002,
         -1.917899489402771, -0.3228563964366913, 1.2000000476837158,
         1.2000000476837158, 1.2000000476837158, 1.2000000476837158},
        {1.2000000476837158, 1.2000000476837158, 1.2000000476837158,
         -0.4738975465297699, -0.7737942934036255, -0.24927717447280884,
         0.49620845913887024, 1.0121490955352783, 1.2000000476837158,
         1.2000000476837158, 1.2000000476837158, 1.2000000476837158},
        {1.2000000476837158, 1.2000000476837158, 1.2000000476837158,
         1.2000000476837158, 1.2000000476837158, 1.2000000476837158,
         1.2000000476837158, 1.2000000476837158, 1.2000000476837158,
         1.2000000476837158, 1.2000000476837158, 1.2000000476837158},
        {1.2000000476837158, 1.2000000476837158, 1.2000000476837158,
         1.2000000476837158, 1.2000000476837158, 1.2000000476837158,
         1.2000000476837158, 1.2000000476837158, 1.2000000476837158,
         1.2000000476837158, 1.2000000476837158, 1.2000000476837158}}}};
  const auto mode = "constant";
  const int32_t pads[] = {0, 0, 1, 3, 0, 0, 2, 4};
  const int32_t number_of_pads = 8;
  const float value = 1.2000000476837158;
  ONNC_RUNTIME_pad_float(NULL, (float *)input_0, input_0_ndim, input_0_dims,
                         (float *)output_0, output_0_ndim, output_0_dims, mode,
                         (int32_t *)pads, number_of_pads, value);
  bool is_correct;
  is_correct = true;
  for (int32_t i = 0; i < 1 * 3 * 7 * 12; ++i) {
    if (abs(((float *)output_0)[i] - ((float *)answer_0)[i]) > 1.0e-7) {
      is_correct = false;
      break;
    }
  }
  ASSERT_TRUE(is_correct);
}

SKYPAT_F(Operator_Pad, test_edge_pad) {
  const float input_0[1][3][4][5] = {
      {{{-1.4908945560455322, 0.5412052273750305, -0.8565057516098022,
         -0.6508788466453552, -1.8524346351623535},
        {0.09636052697896957, -1.1380819082260132, 1.4855937957763672,
         -0.8225699663162231, 0.7394017577171326},
        {0.5004574060440063, 1.7148022651672363, 1.361802339553833,
         -0.8025507926940918, -0.10955031961202621},
        {-1.6004806756973267, 1.195084571838379, 0.5838989019393921,
         -0.11745314300060272, 1.1222316026687622}},
       {{1.3412754535675049, -1.188202142715454, -0.34142646193504333,
         0.6345371007919312, 1.0559297800064087},
        {0.6038965582847595, 1.375205159187317, 0.650257408618927,
         0.23747068643569946, 1.9412531852722168},
        {0.03044682741165161, 0.5061955451965332, -0.5490127801895142,
         0.7350066900253296, -0.9597690105438232},
        {0.02613404579460621, -0.8957343697547913, 0.10570245236158371,
         0.6712355613708496, 0.3529537618160248}},
       {{-0.7364363670349121, 1.0563160181045532, -1.093512773513794,
         0.11671473830938339, -0.7835259437561035},
        {-0.8810521960258484, 1.2116930484771729, -1.1999764442443848,
         -0.6914947628974915, -0.7948287725448608},
        {0.7692975997924805, -0.39135056734085083, -0.07245329767465591,
         0.9548410773277283, 0.5480819344520569},
        {-0.6362527012825012, -1.3656915426254272, -2.1316206455230713,
         0.5198643207550049, -0.17554780840873718}}}};
  const int32_t input_0_ndim = 4;
  const int32_t input_0_dims[] = {1, 3, 4, 5};
  float output_0[1][3][6][7];
  const int32_t output_0_ndim = 4;
  const int32_t output_0_dims[] = {1, 3, 6, 7};
  const float answer_0[1][3][6][7] = {
      {{{-1.4908945560455322, -1.4908945560455322, 0.5412052273750305,
         -0.8565057516098022, -0.6508788466453552, -1.8524346351623535,
         -1.8524346351623535},
        {-1.4908945560455322, -1.4908945560455322, 0.5412052273750305,
         -0.8565057516098022, -0.6508788466453552, -1.8524346351623535,
         -1.8524346351623535},
        {0.09636052697896957, 0.09636052697896957, -1.1380819082260132,
         1.4855937957763672, -0.8225699663162231, 0.7394017577171326,
         0.7394017577171326},
        {0.5004574060440063, 0.5004574060440063, 1.7148022651672363,
         1.361802339553833, -0.8025507926940918, -0.10955031961202621,
         -0.10955031961202621},
        {-1.6004806756973267, -1.6004806756973267, 1.195084571838379,
         0.5838989019393921, -0.11745314300060272, 1.1222316026687622,
         1.1222316026687622},
        {-1.6004806756973267, -1.6004806756973267, 1.195084571838379,
         0.5838989019393921, -0.11745314300060272, 1.1222316026687622,
         1.1222316026687622}},
       {{1.3412754535675049, 1.3412754535675049, -1.188202142715454,
         -0.34142646193504333, 0.6345371007919312, 1.0559297800064087,
         1.0559297800064087},
        {1.3412754535675049, 1.3412754535675049, -1.188202142715454,
         -0.34142646193504333, 0.6345371007919312, 1.0559297800064087,
         1.0559297800064087},
        {0.6038965582847595, 0.6038965582847595, 1.375205159187317,
         0.650257408618927, 0.23747068643569946, 1.9412531852722168,
         1.9412531852722168},
        {0.03044682741165161, 0.03044682741165161, 0.5061955451965332,
         -0.5490127801895142, 0.7350066900253296, -0.9597690105438232,
         -0.9597690105438232},
        {0.02613404579460621, 0.02613404579460621, -0.8957343697547913,
         0.10570245236158371, 0.6712355613708496, 0.3529537618160248,
         0.3529537618160248},
        {0.02613404579460621, 0.02613404579460621, -0.8957343697547913,
         0.10570245236158371, 0.6712355613708496, 0.3529537618160248,
         0.3529537618160248}},
       {{-0.7364363670349121, -0.7364363670349121, 1.0563160181045532,
         -1.093512773513794, 0.11671473830938339, -0.7835259437561035,
         -0.7835259437561035},
        {-0.7364363670349121, -0.7364363670349121, 1.0563160181045532,
         -1.093512773513794, 0.11671473830938339, -0.7835259437561035,
         -0.7835259437561035},
        {-0.8810521960258484, -0.8810521960258484, 1.2116930484771729,
         -1.1999764442443848, -0.6914947628974915, -0.7948287725448608,
         -0.7948287725448608},
        {0.7692975997924805, 0.7692975997924805, -0.39135056734085083,
         -0.07245329767465591, 0.9548410773277283, 0.5480819344520569,
         0.5480819344520569},
        {-0.6362527012825012, -0.6362527012825012, -1.3656915426254272,
         -2.1316206455230713, 0.5198643207550049, -0.17554780840873718,
         -0.17554780840873718},
        {-0.6362527012825012, -0.6362527012825012, -1.3656915426254272,
         -2.1316206455230713, 0.5198643207550049, -0.17554780840873718,
         -0.17554780840873718}}}};
  const auto mode = "edge";
  const int32_t pads[] = {0, 0, 1, 1, 0, 0, 1, 1};
  const int32_t number_of_pads = 8;
  const float value = 0;
  ONNC_RUNTIME_pad_float(NULL, (float *)input_0, input_0_ndim, input_0_dims,
                         (float *)output_0, output_0_ndim, output_0_dims, mode,
                         (int32_t *)pads, number_of_pads, value);
  bool is_correct;
  is_correct = true;
  for (int32_t i = 0; i < 1 * 3 * 6 * 7; ++i) {
    if (abs(((float *)output_0)[i] - ((float *)answer_0)[i]) > 1.0e-7) {
      is_correct = false;
      break;
    }
  }
  ASSERT_TRUE(is_correct);
}

SKYPAT_F(Operator_Pad, test_reflect_pad) {
  const float input_0[1][3][4][5] = {
      {{{-0.9266669154167175, 0.42135316133499146, -0.4384436011314392,
         -1.4985363483428955, 1.4876974821090698},
        {-0.5363991260528564, 0.3700220286846161, -1.3338865041732788,
         2.3064827919006348, 0.08774682879447937},
        {-1.1138793230056763, 0.8499822020530701, 1.3548132181167603,
         -0.5317910313606262, -1.3419454097747803},
        {-0.3366769850254059, 0.2806238532066345, -1.3174785375595093,
         -0.08187193423509598, -0.8323200345039368}},
       {{0.765123188495636, 0.8374351859092712, -0.6945129036903381,
         0.5383126139640808, 1.2036761045455933},
        {-1.7722781896591187, 1.2649949789047241, -1.2421191930770874,
         0.20158126950263977, -0.38023731112480164},
        {-0.24033567309379578, 1.4029070138931274, 0.9034366607666016,
         -0.2123926430940628, 0.3939841389656067},
        {1.422408938407898, 0.6566173434257507, -0.11011670529842377,
         -0.03733830526471138, 0.35730984807014465}},
       {{0.6569117903709412, -0.8313625454902649, -1.0461517572402954,
         -0.8465619683265686, 1.3380651473999023},
        {2.623042583465576, 0.0659722164273262, -0.7567257285118103,
         -0.6992360949516296, 1.3344358205795288},
        {-1.196772813796997, -1.7163329124450684, -0.8796080946922302,
         -0.18652395904064178, -1.0982645750045776},
        {1.6854630708694458, -1.3956750631332397, 0.34234607219696045,
         -0.682165265083313, 0.928147554397583}}}};
  const int32_t input_0_ndim = 4;
  const int32_t input_0_dims[] = {1, 3, 4, 5};
  float output_0[1][3][6][7];
  const int32_t output_0_ndim = 4;
  const int32_t output_0_dims[] = {1, 3, 6, 7};
  const float answer_0[1][3][6][7] = {
      {{{0.3700220286846161, -0.5363991260528564, 0.3700220286846161,
         -1.3338865041732788, 2.3064827919006348, 0.08774682879447937,
         2.3064827919006348},
        {0.42135316133499146, -0.9266669154167175, 0.42135316133499146,
         -0.4384436011314392, -1.4985363483428955, 1.4876974821090698,
         -1.4985363483428955},
        {0.3700220286846161, -0.5363991260528564, 0.3700220286846161,
         -1.3338865041732788, 2.3064827919006348, 0.08774682879447937,
         2.3064827919006348},
        {0.8499822020530701, -1.1138793230056763, 0.8499822020530701,
         1.3548132181167603, -0.5317910313606262, -1.3419454097747803,
         -0.5317910313606262},
        {0.2806238532066345, -0.3366769850254059, 0.2806238532066345,
         -1.3174785375595093, -0.08187193423509598, -0.8323200345039368,
         -0.08187193423509598},
        {0.8499822020530701, -1.1138793230056763, 0.8499822020530701,
         1.3548132181167603, -0.5317910313606262, -1.3419454097747803,
         -0.5317910313606262}},
       {{1.2649949789047241, -1.7722781896591187, 1.2649949789047241,
         -1.2421191930770874, 0.20158126950263977, -0.38023731112480164,
         0.20158126950263977},
        {0.8374351859092712, 0.765123188495636, 0.8374351859092712,
         -0.6945129036903381, 0.5383126139640808, 1.2036761045455933,
         0.5383126139640808},
        {1.2649949789047241, -1.7722781896591187, 1.2649949789047241,
         -1.2421191930770874, 0.20158126950263977, -0.38023731112480164,
         0.20158126950263977},
        {1.4029070138931274, -0.24033567309379578, 1.4029070138931274,
         0.9034366607666016, -0.2123926430940628, 0.3939841389656067,
         -0.2123926430940628},
        {0.6566173434257507, 1.422408938407898, 0.6566173434257507,
         -0.11011670529842377, -0.03733830526471138, 0.35730984807014465,
         -0.03733830526471138},
        {1.4029070138931274, -0.24033567309379578, 1.4029070138931274,
         0.9034366607666016, -0.2123926430940628, 0.3939841389656067,
         -0.2123926430940628}},
       {{0.0659722164273262, 2.623042583465576, 0.0659722164273262,
         -0.7567257285118103, -0.6992360949516296, 1.3344358205795288,
         -0.6992360949516296},
        {-0.8313625454902649, 0.6569117903709412, -0.8313625454902649,
         -1.0461517572402954, -0.8465619683265686, 1.3380651473999023,
         -0.8465619683265686},
        {0.0659722164273262, 2.623042583465576, 0.0659722164273262,
         -0.7567257285118103, -0.6992360949516296, 1.3344358205795288,
         -0.6992360949516296},
        {-1.7163329124450684, -1.196772813796997, -1.7163329124450684,
         -0.8796080946922302, -0.18652395904064178, -1.0982645750045776,
         -0.18652395904064178},
        {-1.3956750631332397, 1.6854630708694458, -1.3956750631332397,
         0.34234607219696045, -0.682165265083313, 0.928147554397583,
         -0.682165265083313},
        {-1.7163329124450684, -1.196772813796997, -1.7163329124450684,
         -0.8796080946922302, -0.18652395904064178, -1.0982645750045776,
         -0.18652395904064178}}}};
  const auto mode = "reflect";
  const int32_t pads[] = {0, 0, 1, 1, 0, 0, 1, 1};
  const int32_t number_of_pads = 8;
  const float value = 0;
  ONNC_RUNTIME_pad_float(NULL, (float *)input_0, input_0_ndim, input_0_dims,
                         (float *)output_0, output_0_ndim, output_0_dims, mode,
                         (int32_t *)pads, number_of_pads, value);
  bool is_correct;
  is_correct = true;
  for (int32_t i = 0; i < 1 * 3 * 6 * 7; ++i) {
    if (abs(((float *)output_0)[i] - ((float *)answer_0)[i]) > 1.0e-7) {
      is_correct = false;
      break;
    }
  }
  ASSERT_TRUE(is_correct);
}
