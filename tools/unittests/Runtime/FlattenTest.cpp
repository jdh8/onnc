#if defined(__GNUC__) || defined(_MSC_VER)
#define restrict __restrict
#else
#define restrict
#endif

extern "C" {
#include <onnc/Runtime/onnc-runtime.h>
}

#undef restrict

#include "relative-error.hpp"
#include <skypat/skypat.h>
SKYPAT_F(Operator_Flatten, test_flatten_axis0) {
  const float input_0[] = {
      0.85815686,  0.294874,    0.42848852,  0.0110280495, 0.43723863,
      0.8164981,   0.8266352,   0.8061139,   0.5457518,    0.47684398,
      0.13309792,  0.003209484, 0.28378332,  0.294395,     0.9638271,
      0.1633598,   0.80289745,  0.8064576,   0.8040852,    0.792487,
      0.7606042,   0.5860266,   0.9737978,   0.56653094,   0.89795846,
      0.3762674,   0.061461125, 0.3799326,   0.68927157,   0.95644176,
      0.46349275,  0.11874364,  0.8124077,   0.50783926,   0.28732184,
      0.7210419,   0.10966637,  0.008862202, 0.2842693,    0.07472405,
      0.3509443,   0.35242504,  0.062227808, 0.5580176,    0.81212693,
      0.004255023, 0.85218763,  0.9310662,   0.53375685,   0.38046178,
      0.36452237,  0.052865926, 0.96433675,  0.7863,       0.1675036,
      0.16398495,  0.31684482,  0.43709216,  0.30487368,   0.66022456,
      0.8316943,   0.03422233,  0.60932004,  0.42263862,   0.5715458,
      0.9621278,   0.11950498,  0.025734186, 0.95280516,   0.28045923,
      0.13787422,  0.22909836,  0.74384654,  0.43478397,   0.37755328,
      0.020569285, 0.18879724,  0.7050575,   0.06407466,   0.47814345,
      0.61084557,  0.16251138,  0.9485573,   0.7720382,    0.28436765,
      0.7703018,   0.85936606,  0.19647717,  0.9645745,    0.71793133,
      0.87671167,  0.93087214,  0.26380017,  0.13455293,   0.37932503,
      0.14515896,  0.006634985, 0.9619427,   0.40986466,   0.19081412,
      0.44542915,  0.24188465,  0.9544009,   0.5512426,    0.7456062,
      0.48830232,  0.21920528,  0.94458705,  0.5089883,    0.46320686,
      0.4570978,   0.082059786, 0.2380652,   0.7819544,    0.28415835,
      0.90521914,  0.8168468,   0.5446076,   0.36975127,   0.06297001};
  const int32_t input_0_ndim = 4;
  const int32_t input_0_dims[] = {2, 3, 4, 5};
  float output_0[120];
  const int32_t output_0_ndim = 2;
  const int32_t output_0_dims[] = {1, 120};
  const float answer_0[] = {
      0.85815686,  0.294874,    0.42848852,  0.0110280495, 0.43723863,
      0.8164981,   0.8266352,   0.8061139,   0.5457518,    0.47684398,
      0.13309792,  0.003209484, 0.28378332,  0.294395,     0.9638271,
      0.1633598,   0.80289745,  0.8064576,   0.8040852,    0.792487,
      0.7606042,   0.5860266,   0.9737978,   0.56653094,   0.89795846,
      0.3762674,   0.061461125, 0.3799326,   0.68927157,   0.95644176,
      0.46349275,  0.11874364,  0.8124077,   0.50783926,   0.28732184,
      0.7210419,   0.10966637,  0.008862202, 0.2842693,    0.07472405,
      0.3509443,   0.35242504,  0.062227808, 0.5580176,    0.81212693,
      0.004255023, 0.85218763,  0.9310662,   0.53375685,   0.38046178,
      0.36452237,  0.052865926, 0.96433675,  0.7863,       0.1675036,
      0.16398495,  0.31684482,  0.43709216,  0.30487368,   0.66022456,
      0.8316943,   0.03422233,  0.60932004,  0.42263862,   0.5715458,
      0.9621278,   0.11950498,  0.025734186, 0.95280516,   0.28045923,
      0.13787422,  0.22909836,  0.74384654,  0.43478397,   0.37755328,
      0.020569285, 0.18879724,  0.7050575,   0.06407466,   0.47814345,
      0.61084557,  0.16251138,  0.9485573,   0.7720382,    0.28436765,
      0.7703018,   0.85936606,  0.19647717,  0.9645745,    0.71793133,
      0.87671167,  0.93087214,  0.26380017,  0.13455293,   0.37932503,
      0.14515896,  0.006634985, 0.9619427,   0.40986466,   0.19081412,
      0.44542915,  0.24188465,  0.9544009,   0.5512426,    0.7456062,
      0.48830232,  0.21920528,  0.94458705,  0.5089883,    0.46320686,
      0.4570978,   0.082059786, 0.2380652,   0.7819544,    0.28415835,
      0.90521914,  0.8168468,   0.5446076,   0.36975127,   0.06297001};
  const int32_t axis = 0;
  ONNC_RUNTIME_flatten_float(nullptr, input_0, input_0_ndim, input_0_dims,
                             output_0, output_0_ndim, output_0_dims, axis);
  ASSERT_TRUE(relative_error(output_0, answer_0, 120) < 1e-5f);
}

SKYPAT_F(Operator_Flatten, test_flatten_axis1) {
  const float input_0[] = {
      0.85815686,  0.294874,    0.42848852,  0.0110280495, 0.43723863,
      0.8164981,   0.8266352,   0.8061139,   0.5457518,    0.47684398,
      0.13309792,  0.003209484, 0.28378332,  0.294395,     0.9638271,
      0.1633598,   0.80289745,  0.8064576,   0.8040852,    0.792487,
      0.7606042,   0.5860266,   0.9737978,   0.56653094,   0.89795846,
      0.3762674,   0.061461125, 0.3799326,   0.68927157,   0.95644176,
      0.46349275,  0.11874364,  0.8124077,   0.50783926,   0.28732184,
      0.7210419,   0.10966637,  0.008862202, 0.2842693,    0.07472405,
      0.3509443,   0.35242504,  0.062227808, 0.5580176,    0.81212693,
      0.004255023, 0.85218763,  0.9310662,   0.53375685,   0.38046178,
      0.36452237,  0.052865926, 0.96433675,  0.7863,       0.1675036,
      0.16398495,  0.31684482,  0.43709216,  0.30487368,   0.66022456,
      0.8316943,   0.03422233,  0.60932004,  0.42263862,   0.5715458,
      0.9621278,   0.11950498,  0.025734186, 0.95280516,   0.28045923,
      0.13787422,  0.22909836,  0.74384654,  0.43478397,   0.37755328,
      0.020569285, 0.18879724,  0.7050575,   0.06407466,   0.47814345,
      0.61084557,  0.16251138,  0.9485573,   0.7720382,    0.28436765,
      0.7703018,   0.85936606,  0.19647717,  0.9645745,    0.71793133,
      0.87671167,  0.93087214,  0.26380017,  0.13455293,   0.37932503,
      0.14515896,  0.006634985, 0.9619427,   0.40986466,   0.19081412,
      0.44542915,  0.24188465,  0.9544009,   0.5512426,    0.7456062,
      0.48830232,  0.21920528,  0.94458705,  0.5089883,    0.46320686,
      0.4570978,   0.082059786, 0.2380652,   0.7819544,    0.28415835,
      0.90521914,  0.8168468,   0.5446076,   0.36975127,   0.06297001};
  const int32_t input_0_ndim = 4;
  const int32_t input_0_dims[] = {2, 3, 4, 5};
  float output_0[120];
  const int32_t output_0_ndim = 2;
  const int32_t output_0_dims[] = {2, 60};
  const float answer_0[] = {
      0.85815686,  0.294874,    0.42848852,  0.0110280495, 0.43723863,
      0.8164981,   0.8266352,   0.8061139,   0.5457518,    0.47684398,
      0.13309792,  0.003209484, 0.28378332,  0.294395,     0.9638271,
      0.1633598,   0.80289745,  0.8064576,   0.8040852,    0.792487,
      0.7606042,   0.5860266,   0.9737978,   0.56653094,   0.89795846,
      0.3762674,   0.061461125, 0.3799326,   0.68927157,   0.95644176,
      0.46349275,  0.11874364,  0.8124077,   0.50783926,   0.28732184,
      0.7210419,   0.10966637,  0.008862202, 0.2842693,    0.07472405,
      0.3509443,   0.35242504,  0.062227808, 0.5580176,    0.81212693,
      0.004255023, 0.85218763,  0.9310662,   0.53375685,   0.38046178,
      0.36452237,  0.052865926, 0.96433675,  0.7863,       0.1675036,
      0.16398495,  0.31684482,  0.43709216,  0.30487368,   0.66022456,
      0.8316943,   0.03422233,  0.60932004,  0.42263862,   0.5715458,
      0.9621278,   0.11950498,  0.025734186, 0.95280516,   0.28045923,
      0.13787422,  0.22909836,  0.74384654,  0.43478397,   0.37755328,
      0.020569285, 0.18879724,  0.7050575,   0.06407466,   0.47814345,
      0.61084557,  0.16251138,  0.9485573,   0.7720382,    0.28436765,
      0.7703018,   0.85936606,  0.19647717,  0.9645745,    0.71793133,
      0.87671167,  0.93087214,  0.26380017,  0.13455293,   0.37932503,
      0.14515896,  0.006634985, 0.9619427,   0.40986466,   0.19081412,
      0.44542915,  0.24188465,  0.9544009,   0.5512426,    0.7456062,
      0.48830232,  0.21920528,  0.94458705,  0.5089883,    0.46320686,
      0.4570978,   0.082059786, 0.2380652,   0.7819544,    0.28415835,
      0.90521914,  0.8168468,   0.5446076,   0.36975127,   0.06297001};
  const int32_t axis = 1;
  ONNC_RUNTIME_flatten_float(nullptr, input_0, input_0_ndim, input_0_dims,
                             output_0, output_0_ndim, output_0_dims, axis);
  ASSERT_TRUE(relative_error(output_0, answer_0, 120) < 1e-5f);
}

SKYPAT_F(Operator_Flatten, test_flatten_axis2) {
  const float input_0[] = {
      0.85815686,  0.294874,    0.42848852,  0.0110280495, 0.43723863,
      0.8164981,   0.8266352,   0.8061139,   0.5457518,    0.47684398,
      0.13309792,  0.003209484, 0.28378332,  0.294395,     0.9638271,
      0.1633598,   0.80289745,  0.8064576,   0.8040852,    0.792487,
      0.7606042,   0.5860266,   0.9737978,   0.56653094,   0.89795846,
      0.3762674,   0.061461125, 0.3799326,   0.68927157,   0.95644176,
      0.46349275,  0.11874364,  0.8124077,   0.50783926,   0.28732184,
      0.7210419,   0.10966637,  0.008862202, 0.2842693,    0.07472405,
      0.3509443,   0.35242504,  0.062227808, 0.5580176,    0.81212693,
      0.004255023, 0.85218763,  0.9310662,   0.53375685,   0.38046178,
      0.36452237,  0.052865926, 0.96433675,  0.7863,       0.1675036,
      0.16398495,  0.31684482,  0.43709216,  0.30487368,   0.66022456,
      0.8316943,   0.03422233,  0.60932004,  0.42263862,   0.5715458,
      0.9621278,   0.11950498,  0.025734186, 0.95280516,   0.28045923,
      0.13787422,  0.22909836,  0.74384654,  0.43478397,   0.37755328,
      0.020569285, 0.18879724,  0.7050575,   0.06407466,   0.47814345,
      0.61084557,  0.16251138,  0.9485573,   0.7720382,    0.28436765,
      0.7703018,   0.85936606,  0.19647717,  0.9645745,    0.71793133,
      0.87671167,  0.93087214,  0.26380017,  0.13455293,   0.37932503,
      0.14515896,  0.006634985, 0.9619427,   0.40986466,   0.19081412,
      0.44542915,  0.24188465,  0.9544009,   0.5512426,    0.7456062,
      0.48830232,  0.21920528,  0.94458705,  0.5089883,    0.46320686,
      0.4570978,   0.082059786, 0.2380652,   0.7819544,    0.28415835,
      0.90521914,  0.8168468,   0.5446076,   0.36975127,   0.06297001};
  const int32_t input_0_ndim = 4;
  const int32_t input_0_dims[] = {2, 3, 4, 5};
  float output_0[120];
  const int32_t output_0_ndim = 2;
  const int32_t output_0_dims[] = {6, 20};
  const float answer_0[] = {
      0.85815686,  0.294874,    0.42848852,  0.0110280495, 0.43723863,
      0.8164981,   0.8266352,   0.8061139,   0.5457518,    0.47684398,
      0.13309792,  0.003209484, 0.28378332,  0.294395,     0.9638271,
      0.1633598,   0.80289745,  0.8064576,   0.8040852,    0.792487,
      0.7606042,   0.5860266,   0.9737978,   0.56653094,   0.89795846,
      0.3762674,   0.061461125, 0.3799326,   0.68927157,   0.95644176,
      0.46349275,  0.11874364,  0.8124077,   0.50783926,   0.28732184,
      0.7210419,   0.10966637,  0.008862202, 0.2842693,    0.07472405,
      0.3509443,   0.35242504,  0.062227808, 0.5580176,    0.81212693,
      0.004255023, 0.85218763,  0.9310662,   0.53375685,   0.38046178,
      0.36452237,  0.052865926, 0.96433675,  0.7863,       0.1675036,
      0.16398495,  0.31684482,  0.43709216,  0.30487368,   0.66022456,
      0.8316943,   0.03422233,  0.60932004,  0.42263862,   0.5715458,
      0.9621278,   0.11950498,  0.025734186, 0.95280516,   0.28045923,
      0.13787422,  0.22909836,  0.74384654,  0.43478397,   0.37755328,
      0.020569285, 0.18879724,  0.7050575,   0.06407466,   0.47814345,
      0.61084557,  0.16251138,  0.9485573,   0.7720382,    0.28436765,
      0.7703018,   0.85936606,  0.19647717,  0.9645745,    0.71793133,
      0.87671167,  0.93087214,  0.26380017,  0.13455293,   0.37932503,
      0.14515896,  0.006634985, 0.9619427,   0.40986466,   0.19081412,
      0.44542915,  0.24188465,  0.9544009,   0.5512426,    0.7456062,
      0.48830232,  0.21920528,  0.94458705,  0.5089883,    0.46320686,
      0.4570978,   0.082059786, 0.2380652,   0.7819544,    0.28415835,
      0.90521914,  0.8168468,   0.5446076,   0.36975127,   0.06297001};
  const int32_t axis = 2;
  ONNC_RUNTIME_flatten_float(nullptr, input_0, input_0_ndim, input_0_dims,
                             output_0, output_0_ndim, output_0_dims, axis);
  ASSERT_TRUE(relative_error(output_0, answer_0, 120) < 1e-5f);
}

SKYPAT_F(Operator_Flatten, test_flatten_axis3) {
  const float input_0[] = {
      0.85815686,  0.294874,    0.42848852,  0.0110280495, 0.43723863,
      0.8164981,   0.8266352,   0.8061139,   0.5457518,    0.47684398,
      0.13309792,  0.003209484, 0.28378332,  0.294395,     0.9638271,
      0.1633598,   0.80289745,  0.8064576,   0.8040852,    0.792487,
      0.7606042,   0.5860266,   0.9737978,   0.56653094,   0.89795846,
      0.3762674,   0.061461125, 0.3799326,   0.68927157,   0.95644176,
      0.46349275,  0.11874364,  0.8124077,   0.50783926,   0.28732184,
      0.7210419,   0.10966637,  0.008862202, 0.2842693,    0.07472405,
      0.3509443,   0.35242504,  0.062227808, 0.5580176,    0.81212693,
      0.004255023, 0.85218763,  0.9310662,   0.53375685,   0.38046178,
      0.36452237,  0.052865926, 0.96433675,  0.7863,       0.1675036,
      0.16398495,  0.31684482,  0.43709216,  0.30487368,   0.66022456,
      0.8316943,   0.03422233,  0.60932004,  0.42263862,   0.5715458,
      0.9621278,   0.11950498,  0.025734186, 0.95280516,   0.28045923,
      0.13787422,  0.22909836,  0.74384654,  0.43478397,   0.37755328,
      0.020569285, 0.18879724,  0.7050575,   0.06407466,   0.47814345,
      0.61084557,  0.16251138,  0.9485573,   0.7720382,    0.28436765,
      0.7703018,   0.85936606,  0.19647717,  0.9645745,    0.71793133,
      0.87671167,  0.93087214,  0.26380017,  0.13455293,   0.37932503,
      0.14515896,  0.006634985, 0.9619427,   0.40986466,   0.19081412,
      0.44542915,  0.24188465,  0.9544009,   0.5512426,    0.7456062,
      0.48830232,  0.21920528,  0.94458705,  0.5089883,    0.46320686,
      0.4570978,   0.082059786, 0.2380652,   0.7819544,    0.28415835,
      0.90521914,  0.8168468,   0.5446076,   0.36975127,   0.06297001};
  const int32_t input_0_ndim = 4;
  const int32_t input_0_dims[] = {2, 3, 4, 5};
  float output_0[120];
  const int32_t output_0_ndim = 2;
  const int32_t output_0_dims[] = {24, 5};
  const float answer_0[] = {
      0.85815686,  0.294874,    0.42848852,  0.0110280495, 0.43723863,
      0.8164981,   0.8266352,   0.8061139,   0.5457518,    0.47684398,
      0.13309792,  0.003209484, 0.28378332,  0.294395,     0.9638271,
      0.1633598,   0.80289745,  0.8064576,   0.8040852,    0.792487,
      0.7606042,   0.5860266,   0.9737978,   0.56653094,   0.89795846,
      0.3762674,   0.061461125, 0.3799326,   0.68927157,   0.95644176,
      0.46349275,  0.11874364,  0.8124077,   0.50783926,   0.28732184,
      0.7210419,   0.10966637,  0.008862202, 0.2842693,    0.07472405,
      0.3509443,   0.35242504,  0.062227808, 0.5580176,    0.81212693,
      0.004255023, 0.85218763,  0.9310662,   0.53375685,   0.38046178,
      0.36452237,  0.052865926, 0.96433675,  0.7863,       0.1675036,
      0.16398495,  0.31684482,  0.43709216,  0.30487368,   0.66022456,
      0.8316943,   0.03422233,  0.60932004,  0.42263862,   0.5715458,
      0.9621278,   0.11950498,  0.025734186, 0.95280516,   0.28045923,
      0.13787422,  0.22909836,  0.74384654,  0.43478397,   0.37755328,
      0.020569285, 0.18879724,  0.7050575,   0.06407466,   0.47814345,
      0.61084557,  0.16251138,  0.9485573,   0.7720382,    0.28436765,
      0.7703018,   0.85936606,  0.19647717,  0.9645745,    0.71793133,
      0.87671167,  0.93087214,  0.26380017,  0.13455293,   0.37932503,
      0.14515896,  0.006634985, 0.9619427,   0.40986466,   0.19081412,
      0.44542915,  0.24188465,  0.9544009,   0.5512426,    0.7456062,
      0.48830232,  0.21920528,  0.94458705,  0.5089883,    0.46320686,
      0.4570978,   0.082059786, 0.2380652,   0.7819544,    0.28415835,
      0.90521914,  0.8168468,   0.5446076,   0.36975127,   0.06297001};
  const int32_t axis = 3;
  ONNC_RUNTIME_flatten_float(nullptr, input_0, input_0_ndim, input_0_dims,
                             output_0, output_0_ndim, output_0_dims, axis);
  ASSERT_TRUE(relative_error(output_0, answer_0, 120) < 1e-5f);
}

SKYPAT_F(Operator_Flatten, test_flatten_default_axis) {
  const float input_0[] = {
      0.3363765,   0.9027224,   0.8146048,   0.67443305,  0.35717863,
      0.5911986,   0.20965739,  0.63641447,  0.4911648,   0.3817988,
      0.53700155,  0.6756799,   0.688123,    0.29188758,  0.87604886,
      0.036046058, 0.22054876,  0.66547084,  0.375937,    0.10763818,
      0.80517,     0.2374761,   0.4630112,   0.097665556, 0.68985856,
      0.054972395, 0.62163174,  0.7268024,   0.6747526,   0.6306392,
      0.86474884,  0.74365497,  0.7130701,   0.6032443,   0.2894027,
      0.24500087,  0.03314582,  0.12188089,  0.59621876,  0.9441081,
      0.21825954,  0.68957573,  0.12590845,  0.9720098,   0.18538196,
      0.13328116,  0.40464342,  0.2087818,   0.6573588,   0.6765487,
      0.035088778, 0.07282588,  0.9503145,   0.33059663,  0.35007,
      0.5459326,   0.49210042,  0.8075748,   0.5258714,   0.014848916,
      0.98395777,  0.12044623,  0.71832603,  0.57094646,  0.67136854,
      0.7121655,   0.64271593,  0.16682397,  0.49775678,  0.6751713,
      0.026967915, 0.037337467, 0.8187568,   0.4748614,   0.3556487,
      0.61853236,  0.30091792,  0.6589152,   0.56070554,  0.2777375,
      0.58232844,  0.80136937,  0.060688853, 0.40405595,  0.13963734,
      0.6154284,   0.4648281,   0.5819381,   0.9079994,   0.36024883,
      0.43139958,  0.90573287,  0.8754865,   0.72553617,  0.9271312,
      0.2635384,   0.1713764,   0.13459605,  0.88348,     0.59732306,
      0.21646038,  0.35385418,  0.009603718, 0.91602343,  0.7235015,
      0.5765855,   0.08730532,  0.01857973,  0.9557366,   0.683084,
      0.48005748,  0.22590245,  0.040250335, 0.62022144,  0.9630328,
      0.48518017,  0.4733172,   0.28157592,  0.5142474,   0.8216849};
  const int32_t input_0_ndim = 4;
  const int32_t input_0_dims[] = {5, 4, 3, 2};
  float output_0[120];
  const int32_t output_0_ndim = 2;
  const int32_t output_0_dims[] = {5, 24};
  const float answer_0[] = {
      0.3363765,   0.9027224,   0.8146048,   0.67443305,  0.35717863,
      0.5911986,   0.20965739,  0.63641447,  0.4911648,   0.3817988,
      0.53700155,  0.6756799,   0.688123,    0.29188758,  0.87604886,
      0.036046058, 0.22054876,  0.66547084,  0.375937,    0.10763818,
      0.80517,     0.2374761,   0.4630112,   0.097665556, 0.68985856,
      0.054972395, 0.62163174,  0.7268024,   0.6747526,   0.6306392,
      0.86474884,  0.74365497,  0.7130701,   0.6032443,   0.2894027,
      0.24500087,  0.03314582,  0.12188089,  0.59621876,  0.9441081,
      0.21825954,  0.68957573,  0.12590845,  0.9720098,   0.18538196,
      0.13328116,  0.40464342,  0.2087818,   0.6573588,   0.6765487,
      0.035088778, 0.07282588,  0.9503145,   0.33059663,  0.35007,
      0.5459326,   0.49210042,  0.8075748,   0.5258714,   0.014848916,
      0.98395777,  0.12044623,  0.71832603,  0.57094646,  0.67136854,
      0.7121655,   0.64271593,  0.16682397,  0.49775678,  0.6751713,
      0.026967915, 0.037337467, 0.8187568,   0.4748614,   0.3556487,
      0.61853236,  0.30091792,  0.6589152,   0.56070554,  0.2777375,
      0.58232844,  0.80136937,  0.060688853, 0.40405595,  0.13963734,
      0.6154284,   0.4648281,   0.5819381,   0.9079994,   0.36024883,
      0.43139958,  0.90573287,  0.8754865,   0.72553617,  0.9271312,
      0.2635384,   0.1713764,   0.13459605,  0.88348,     0.59732306,
      0.21646038,  0.35385418,  0.009603718, 0.91602343,  0.7235015,
      0.5765855,   0.08730532,  0.01857973,  0.9557366,   0.683084,
      0.48005748,  0.22590245,  0.040250335, 0.62022144,  0.9630328,
      0.48518017,  0.4733172,   0.28157592,  0.5142474,   0.8216849};
  const int32_t axis = 1;
  ONNC_RUNTIME_flatten_float(nullptr, input_0, input_0_ndim, input_0_dims,
                             output_0, output_0_ndim, output_0_dims, axis);
  ASSERT_TRUE(relative_error(output_0, answer_0, 120) < 1e-5f);
}
